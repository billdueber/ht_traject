
if [ $# -ne 1 ] 
then
  echo
  echo "catchup_since: run all deletes/includes in order since the given date"
  echo
  echo "USAGE:"
  echo "    catchup_since  YYYYMMDD  <optional logfile> "
  echo
  exit
fi


HERE=`dirname $0`
SCRIPTDIR=`realpath $HERE`
TDIR=`realpath $SCRIPTDIR/..`
[[ ! -z $2 ]] && logfile=`realpath $2`


source $SCRIPTDIR/utils.sh


# Hathitrust uses yesterday's date as the last day

log "Keep in mind that the files are dated one day back" $logfile

TODAY=`date +"%Y%m%d"`
LASTDATE=`date -d "$TODAY - 1 day" +"%Y%m%d"`
STARTDATE=`date -d "$1 - 1 day" +"%Y%m%d"`



fulldate=`date -d $STARTDATE`
log "Catching up from $STARTDATE aka $fulldate" $logfile

DATESTR=$STARTDATE

until [[ $DATESTR > $LASTDATE ]]; do
   $SCRIPTDIR/index_date $DATESTR
   DATESTR=`date -d "$DATESTR + 1 day" +"%Y%m%d"`

done


